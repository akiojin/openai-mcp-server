# OpenAI API MCP サーバープロジェクトガイドライン

## 重要なルール

- **日本語で回答する**
- **エコノミーAPIはv2のみを利用する** - レガシーv1 APIは使用しない
- **ソースコード修正後は必ずビルドしてdistを更新する** - `npm run build`を実行
- **ルールの追加は必ずCLAUDE.mdに追記する**
- **CHANGELOG.mdは英語で記載する**
- **markdownlintの警告を全て修正する** - 見出しの前後に空行、コードブロックの言語指定、ファイル末尾改行など
- **一覧のタスクが完了したら、コミットログを自動生成してコミットを行う**
- **コミットログはcommitlint形式で生成する** - type(scope): description の形式
- **コミットログは日本語** - コミットメッセージの説明部分は日本語で記載
- **コミットの際には、必ず承認を取ること** - ユーザーの明示的な許可なしにコミットしない
- **パッケージが足りない場合はインストールを行う** - 必要な依存関係を自動的にインストール
- **モデルは /model opus を優先的に利用するが、レートリミットがかかった場合 /model sonnet で自動的に切り替える**
- **できる限り熟考して解決する** - 複雑な問題や改善提案には深い思考と包括的な分析を行う
- **割り込みで別の処理をした後は、必ず残っているタスクの続きを実行する**
- **ビルドエラーは必ず排除する** - TypeScriptコンパイルエラーを放置しない
- **何か更新された場合は、関連するドキュメントを必ず更新する**
- **作業内容はCLAUDE.mdにToDoとしてチェックボックスで残す** - 作業完了時にはCLAUDE.mdを更新する
- **作業開始前に進行中タスクに追加・更新する** - 新しい作業を始める前に必ずCLAUDE.mdの進行中タスクを更新
- **タスク完了時にはドキュメントのToDoを更新** - 完了したタスクには[x]を付けて更新
- **ToDoはCLAUDE.mdに作成する** - タスク管理はCLAUDE.md内のチェックボックス形式で行う
- **TypeScriptで実装する** - すべてのソースコードはTypeScriptで記述し、型安全性を確保する
- **「バージョンアップして」と指示があった場合**:
  1. `git status`でコミットされていない変更がないか確認（変更がある場合はエラー）
  2. 前回のバージョンアップからの差分をCHANGELOG.mdに追加
  3. 変更内容に応じて適切なバージョンタイプを選択:
     - `patch`: バグ修正のみ
     - `minor`: 新機能追加（後方互換性あり）
     - `major`: 破壊的変更
  4. `npm version [patch/minor/major]`を実行

## 概要

AIアシスタントがChatGPTと対話できるようにするModel Context Protocol (MCP)サーバーです。

## プロジェクト構造

```text
/
├── src/                    # TypeScriptソースコード
│   ├── index.ts           # メインエントリーポイント
├── CHANGELOG.md           # 変更履歴
├── CLAUDE.md              # プロジェクトガイドライン
└── README.md              # プロジェクト説明
```

## 環境設定

### 必要な環境変数

```bash
OPENAI_API_KEY=your_api_key           # OpenAI API キー
```

### セットアップ手順

```bash
# 依存関係のインストール
npm install

# プロジェクトのビルド
npm run build

# 開発モード（ウォッチ）
npm run watch

# サーバーの起動
npm start
```

## 開発ガイドライン

### コードスタイル

- `.editorconfig`の規約に準拠
- TypeScriptの型定義を厳密に使用
- エラーハンドリングを適切に実装

### コミット前のチェックリスト

1. ビルドの成功確認: `npm run build`
2. TypeScriptエラーチェック: `npx tsc --noEmit`
3. サーバー起動確認: `npm start`

## セキュリティ

### 重要事項

- `.env`ファイルは**絶対にコミットしない**
- APIキーは環境変数で管理
- サーバーサイドAPIのみを使用（クライアントAPIは使用しない）

## コントリビューション

### 開発フロー

1. 既存のissueを確認してから新規作成
2. 既存のコードパターンとスタイルに準拠
3. 機能追加時は対応するドキュメントも更新
4. プルリクエスト前に全テストを実行

### コードレビュー基準

- TypeScript型の適切な使用
- エラーハンドリングの実装
- セキュリティベストプラクティスの遵守

## 改善タスク一覧

## 完了タスク

- [x] プロジェクト構造の初期設定
- [x] package.jsonの作成
- [x] TypeScriptソースコードの実装（英語版）
- [x] 依存関係のインストール
- [x] ビルド設定とコンパイル
- [x] .gitignoreの作成
- [x] tsconfig.jsonの作成
- [x] .env.exampleファイルの作成
- [x] README.mdの更新（英語版）
- [x] CHANGELOG.mdの作成（英語版）
- [x] markdownlintエラーの修正
- [x] ツールの説明文を詳細化してエージェントの理解を向上
- [x] トリガーフレーズを追加してエージェントが明示的にツールを呼び出しやすくする
- [x] トリガーフレーズを必須条件に変更して明示的な呼び出しを強制
- [x] TypeScript型定義の改善（as anyの削除）
- [x] 入力値バリデーションの実装
- [x] OpenAI API固有エラーハンドリングの強化
- [x] ESLint設定の追加
- [x] Prettier設定の追加
- [x] 依存関係のインストールとビルドテスト
- [x] 未着手タスクリストの整理と重複削除
- [x] Husky pre-commit hooks設定
- [x] 構造化ログシステムの実装
- [x] ユニットテストの実装（Jest）
- [x] 設定ファイル（config.json）の実装
- [x] OpenAI SDK型定義の活用
- [x] エラー分類と適切なエラーコード定義
- [x] 環境変数検証の強化
- [x] APIキー検証の強化
- [x] テストカバレッジを80%以上に向上（81.68%達成）
- [x] エラーケースの網羅的なテスト追加（errors.tsとenv-validator.tsのテスト実装）

## 進行中タスク

## 未着手タスク

### 🔴 優先度：高 (1-2週間で実施)

#### テスト・品質向上

- [ ] 統合テストの実装（OpenAI APIモック使用）
- [ ] 依存性注入パターンの導入（テスタビリティ向上）

#### CI/CD・自動化
- [ ] GitHub Actions設定（テスト、ビルド、型チェック）
- [ ] 自動リリースワークフローの構築
- [ ] コードカバレッジの自動レポート生成
- [ ] セマンティックバージョニングの自動化

#### パフォーマンス・信頼性
- [ ] リクエスト/レスポンスキャッシュ機能の実装
- [ ] タイムアウト設定の実装と設定可能化
- [ ] リトライロジックの改善（指数バックオフ）
- [ ] グレースフルシャットダウンの実装

### 🟡 優先度：中 (1-2ヶ月で実施)

#### 機能拡張
- [ ] ストリーミングレスポンス対応
- [ ] Function Calling機能の実装
- [ ] Vision API（画像入力）対応
- [ ] embeddings APIサポート追加
- [ ] カスタムシステムプロンプト管理機能

#### 運用・監視
- [ ] ヘルスチェックエンドポイントの追加
- [ ] メトリクス収集機能（Prometheus形式）
- [ ] 構造化ログのエクスポート機能
- [ ] パフォーマンスベンチマークの実装

#### ドキュメント
- [ ] API仕様書の自動生成（OpenAPI/Swagger）
- [ ] アーキテクチャ図の作成（Mermaid）
- [ ] トラブルシューティングガイドの作成
- [ ] 開発者向けコントリビューションガイド

